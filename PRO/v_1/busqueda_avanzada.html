
<!DOCTYPE HTML>
<html lang="es">
<head>
	<meta charset="UTF-8">
	<title>Inicio - Proyecto</title>
	<!-- <meta name="viewport" content="width=device-width , initial-scale=1 ,maximum-scale=1"> -->
	<meta name="description" content="Nubeti - Empresa Colombia de desarrollo de Software e implementaci&oacute;n de Google Apps">
	<meta name="keywords" content="Desarrollo de software Bogot&aacute; Colombia, Implementaci&oacute;n Google Apps">
	<meta name="author" content="Dise&ntilde;o web: nubeti.co [Oscar Ortiz Perez, Juan Rubiano]">

	<link rel="shortcut icon" href="public/vistas/web/imgs/icons/favicon.ico" type="image/x-icon">
	<link rel="apple-touch-icon" href="public/vistas/web/imgs/icons/favicon.png" type="image/png">

	<link rel="stylesheet" href="public/vistas/web/css/bootstrap.css">
	<link rel="stylesheet" href="public/vistas/web/css/portal_general.css">
	<!--[if IE]> <link href="public/vistas/web/css/ie.css" media="screen, projection" rel="stylesheet" type="text/css" /><![endif]-->

	<script type="text/javascript" src="public/vistas/web/js/modernizr.custom.js"></script>
	<script type="text/javascript" src="public/vistas/web/js/jquery.min.js"></script>

	<script type="text/javascript" src="public/vistas/web/js/portal_diseno.js"></script>
	<script src="public/vistas/web/js/validaciones.js"></script>
</head>
<body>
<!-- css básico -->
<style>
	.list{
		display: none;
		position: absolute;
		background: #fff;
		max-height: 200px;
		overflow-y: auto;
		width: 300px;
		padding: 10px;
	}
	.list .hightLight{
		outline: 1px solid orange;
	}
</style>
<div class="wrapper">
	<div class="busquedaBox">
		<ul class="liSelects"></ul>
		<input type="text" onfocus="inputFilter.search(this,event)">
		<!-- ul.list>(li>label[for="id_$""]>input[type="checkbox" id="id_$"]+{listado $})*10 -->
		<ul class="list">
			<li><label for="id_1"><input type="checkbox" id="id_1"> perro 01</label></li>
			<li><label for="id_2"><input type="checkbox" id="id_2"> gato .2</label></li>
			<li><label for="id_3"><input type="checkbox" id="id_3"> idiota 03</label></li>
			<li><label for="id_4"><input type="checkbox" id="id_4"> pato 04</label></li>
			<li><label for="id_5"><input type="checkbox" id="id_5"> mariposa .5</label></li>
			<li><label for="id_6"><input type="checkbox" id="id_6"> venado 06</label></li>
			<li><label for="id_7"><input type="checkbox" id="id_7"> pajaro 07</label></li>
			<li><label for="id_8"><input type="checkbox" id="id_8"> gallina .8</label></li>
			<li><label for="id_9"><input type="checkbox" id="id_9"> sapo 09</label></li>
			<li><label for="id_10"><input type="checkbox" id="id_10"> comadreja 10</label></li>
		</ul>
	</div>

	<hr>

	<div class="busquedaBox">
		<ul class="liSelects"></ul>
		<input type="text" onfocus="inputFilter.search(this,event)">
		<!-- ul.list>(li>label[for="id2_$""]>input[type="checkbox" id="id2_$"]+{listado $})*10 -->
		<ul class="list">
			<li><label for="id2_1"><input type="checkbox" id="id2_1">listado 1</label></li>
			<li><label for="id2_2"><input type="checkbox" id="id2_2">listado 2</label></li>
			<li><label for="id2_3"><input type="checkbox" id="id2_3">listado 3</label></li>
			<li><label for="id2_4"><input type="checkbox" id="id2_4">listado 4</label></li>
			<li><label for="id2_5"><input type="checkbox" id="id2_5">listado 5</label></li>
			<li><label for="id2_6"><input type="checkbox" id="id2_6">listado 6</label></li>
			<li><label for="id2_7"><input type="checkbox" id="id2_7">listado 7</label></li>
			<li><label for="id2_8"><input type="checkbox" id="id2_8">listado 8</label></li>
			<li><label for="id2_9"><input type="checkbox" id="id2_9">listado 9</label></li>
			<li><label for="id2_10"><input type="checkbox" id="id2_10">listado 10</label></li>
		</ul>
	</div>
</div>

<script>
	var inputFilter = {
		_filtered : 'filtered',//clse que identifica cuando el input ya se le aplicó la función de filtrar
		_checked : 'checked',//marcado como seleccionado
		_punter : 'hightLight',//marcado como punteado para lista y [arriba] [abajp]
		checks : function(vars){

			//asignació de comportamiento por checks
			vars.$allLists.each(function(index,element){
				//se valida si ya tiene un comportamiento
				if( !$(element).is('.ini') ){

					//envuelvo objeto en jquery
					var $this = $(this);
					//label
					var $label = $this.find('label');
					//input checkbox
					var $check = $this.find('input');
					//guarda variable
					var checkbox = $check[0];

					//guardo un data para saber que el objeto un evento asignado
					$this.addClass('ini');

					//mueve los elementos a Ul seleccionados si hay alguno y le añade la clase checked
					if( checkbox.checked ) vars.$contListSelect.append( $this.addClass(inputFilter._checked) );
						
					//evento click
					$this.on({
						'click': function(event){
							//ayuda a validar si el evento se produce en el input para validar la acción
							var isCheckbox = $(event.target).is($check);
							//console.log('si das click en label el click se genera dos veces, una para el lael otra para el input');
							//cuando el click se realiza en el label, label vuelve a dar click en el check
							//por lo que solo se ejecuta esta función cuando el click llega al input directamente
							//o atravez de el label

							if(isCheckbox){
								//mueve el elemento según su estado
								if(!checkbox.checked){
									//mueve elemento solo si au padre no es el mismo donde se moverá
									if( !$this.closest(vars.$contList).length ){
										vars.$contList.append($this);
									}
									//remueve clase para dejar disponible
									$this.removeClass(inputFilter._checked).removeClass(inputFilter._punter);
									//enfoca caja para que se se autorefresque lo buscado
									inputFilter.finder(vars);
								}else{
									//mueve elemento solo si au padre no es el mismo donde se moverá
									if( !$this.closest(vars.$contListSelect).length ){
										vars.$contListSelect.append($this);
									}
									//añade clase para saber que es disponible
									$this.addClass(inputFilter._checked);
								}
							}
							//si el click es directamente 3en el li se retransmite al input
							if( $(event.target).is($this) ){
								$check.click();
							}
						},
						'mouseover':function(){
							$this.addClass(inputFilter._punter).siblings().removeClass(inputFilter._punter);
						}
					});
				}
			});

		},
		resort : function(vars){


		},

		finder : function(vars){
			//variable de texto escrito
			var inputText = vars.$input.val();
			//variable de expresión regular en base a escritp
			var regEx = new RegExp(inputText,'i');

			//guarda conincidencias de listado en objetos $()
			 var $listFilter = vars.$lists.not('.'+inputFilter._checked)
			 		//oculta los objetos y comienza filtro
			 		.hide().filter(function(index,element){
			 		//si existen coinsidencias 
					if( $(element).text().match(regEx) )

						//el obejto es devuelto
						return $(element);
				}).show();//muestra os elementos que coinsiden

		},
		select : function(vars,key){
			//selecciona los li pertenecientes a la lista de disponibles
			var $liHovers = vars.$allLists.not('.'+inputFilter._checked).filter(':visible');
			//selecciona el putero o antes seleccionado con las teclas de arriba abajo
			var $punter = $liHovers.filter('.'+inputFilter._punter);
			//contiene el número de elemento a mostrar
			var inicio=0;

			//si está resaltado [arriba] [abajo] se carga en el puntero actual
			if( !$punter.length ){
				//ubica el puntero en l primer item
				$liHovers.eq(inicio).addClass(inputFilter._punter);
			}else{
				//ubica el puntero en el item seleccionado anteriormente
				inicio = $liHovers.index($punter) ;

				//remueve todas las clases seleccionadas
				vars.$allLists.removeClass(inputFilter._punter);

				//dirige el evento del botón [arriba] [abajo]
				if (key==40 && $punter.length){
					//flecha abajo
					$liHovers.eq(inicio).next().addClass(inputFilter._punter);

				}else if(key==38 && $punter.length){
					//fleha arriba
					$liHovers.eq(inicio).prev().addClass(inputFilter._punter);
				}else if(key==13){
					//si se realiza un enter
					$liHovers.eq(inicio).click();
					event.preventDefault();
				}
			}
			

		},
		search : function(input,evento){

			//si no se ha inicializado se inicializa

			if( !$(input).is('.'+inputFilter._filtered) ){
				//contiene el las variables			
				var vars = {};
				//contiene el input
				vars.$input = $(input);
				//selecciona el scontenedor de todo
				vars.$contGen = vars.$input.closest('.busquedaBox');
				//contenedor de listados
				vars.$contList = vars.$contGen.find('.list');
				//listado de opciones para seleccionar
				vars.$lists = vars.$contList.find('li');
				//contenedor seleccionadas
				vars.$contListSelect = vars.$contGen.find('.liSelects');
				//listado de opciones seleccionadas
				vars.$listSelect = vars.$contListSelect.find('li');//no parece necesitarse
				//tidas las li
				vars.$allLists = vars.$lists.add( vars.$listSelect );

				//guarda un dato en el input para saber que ya tiene la función de búsqueda aplicada;
				vars.$input.addClass(inputFilter._filtered);
				//variable para verificar focus de inout
				vars.unfocus = null;
				//tiempo de escape unfocus
				vars.timeUnfocus = 250;

				//asignafuncion checks a listas 
				inputFilter.checks( vars );

				//ejecuta la función debúsqueda
				vars.$input.on({
					'keyup' : function(event) {

						//al escribir texto se filtrarán búsquedas
						inputFilter.finder(vars);

					},
					'keydown':function(event){
						var key = event.keyCode;
						if(key == 38 || key == 40 || key == 13 ){

							inputFilter.select(vars,key);
							
						}
					},
					'focus':function(){
						//muestra lñistado
						vars.$contList.show();						
						if(vars.unfocus){
							//resetea intervalo
							clearInterval(vars.unfocus);
						}
					},
					'focusout':function(){
						//oculta listado en un tiempo
						vars.unfocus = setTimeout(function() {
							vars.$contList.hide();
						}, 250);
					}

				}
				);

			}

		},

		ini: function(){

			//selecciona elemento para autoiniciar en base a su etiqueta y attributo
			var $input = $('input[onfocus*="inputFilter"]');
			
			if( $input.length ){
				//si existe el elemento ejecuta la función para aplicar campos
				$input.each(function(index,element){
					inputFilter.search(this);
				});
			}

		}
	}; $(function(){ inputFilter.ini(); });
	
</script>
</body>
</html>